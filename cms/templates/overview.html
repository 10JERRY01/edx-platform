<%inherit file="base.html" />
<%!
   from time import mktime
   import dateutil.parser
   import logging
   from datetime import datetime
%>
<%! from django.core.urlresolvers import reverse %>
<%block name="title">CMS Courseware Overview</%block>

<%namespace name='static' file='static_content.html'/>
<%namespace name="units" file="widgets/units.html" />

<%block name="jsextra">
<link rel="stylesheet" type="text/css" href="${static.url('js/vendor/timepicker/jquery.timepicker.css')}" />
<script src="${static.url('js/vendor/timepicker/jquery.timepicker.js')}"></script>
<script src="${static.url('js/vendor/timepicker/datepair.js')}"></script>
<script src="${static.url('js/vendor/date.js')}"></script>
</%block>

<%block name="header_extras">
  <script type="text/template" id="new-section-template">
    <section class="courseware-section branch new-section">
      <header>
        <a href="#" class="expand-collapse-icon collapse"></a>
        <div class="item-details">
          <h3 class="section-name"><input type="text" value="New Section Name" class="new-section-name" /><a href="#" class="new-section-name-save" data-parent="${parent_location}" data-template="${new_section_template}">Save</a><a href="#" class="new-section-name-cancel">Cancel</a></h3>
        </div>
      </header>
    </section>
  </script>

  <script type="text/template" id="new-assignment-template">
    <section class="courseware-assignment branch new-assignment">
      <header>
        <a href="#" class="expand-collapse-icon collapse"></a>
        <div class="item-details">
          <h3 class="assignment-name">
            <input type="text" value="New Assignment Name" class="new-section-name" />
            <a href="#" class="new-assignment-name-save" data-parent="${parent_location}" data-template="${new_section_template}">Save</a>
            <a href="#" class="new-assignment-name-cancel">Cancel</a>
          </h3>
        </div>
      </header>
    </section>
  </script>

  <script type="text/template" id="new-subsection-template">
    <li class="branch collapsed">
      <div class="section-item editing">
        <div>
          <span class="folder-icon"></span>
          <span class="subsection-name">
            <input type="text" value="New Subsection" class="new-subsection-name-input" />
          </span>
          <a href="#" class="new-subsection-name-save">Save</a>
          <a href="#" class="new-subsection-name-cancel">Cancel</a>
        </div>
      </div>
      <ol>
        <li>
          <a href="unit.html" class="new-unit-item">
            <span class="new-unit-icon"></span>New Unit
          </a>
        </li>
      </ol>
    </li>
  </script>


</%block>

<%block name="content">
  <div class="edit-subsection-publish-settings">
    <div class="settings">
      <h3>Section Release Date</h3>
      <div class="picker datepair">
        <input class="start-date date" type="text" name="start_date" value="" placeholder="MM/DD/YYYY" class="date" size='15' autocomplete="off"/>
        <input class="start-time time" type="text" name="start_time" value="" placeholder="HH:MM" class="time" size='10' autocomplete="off"/>
        <div class="description">
          <p>On the date set above, this section – <strong class="section-name"></strong> – will be released to students along with the 5 subsections within it. Any units marked private will only be visible to admins.</p>
        </div>
      </div>
      <a href="#" class="save-button">Save</a><a href="#" class="cancel-button">Cancel</a>
    </div>
  </div>

  <div class="main-wrapper">
    <div class="inner-wrapper">
      <h1>Courseware</h1>
      <div class="page-actions"></div>
      <article class="courseware-overview" data-course-id="${context_course.location.url()}">
        
        <nav class="new-courseware-element-nav">
          <ul>
            <li>
              <a class="new-courseware-section-button" href="#"><span class="plus-icon"></span> New Section</a></li>
            <li>
              <a class="new-courseware-assignment-button" href="#"><span class="plus-icon"></span> New Assignment</a>
            </li>
          </ul>
        </nav>

        % for section in sections:
        <section class="courseware-section branch" data-id="${section.location}">
          <header>
            <a href="#" class="expand-collapse-icon collapse"></a>
            <div class="item-details" data-id="${section.location}">
              <h3 class="section-name">
                <span class="section-name-span">${section.display_name}</span>
                <div class="section-name-edit" style="display:none">
                  <input type="text" value="${section.display_name}" class="edit-section-name" autocomplete="off"/>
                  <a href="#" class="save-button edit-section-name-save">Save</a><a href="#" class="cancel-button edit-section-name-cancel">Cancel</a>
                </div>
              </h3>
              <div class="section-published-date">
                <%
                  start_date = datetime.fromtimestamp(mktime(section.start)) if section.start is not None else None
                  start_date_str = start_date.strftime('%m/%d/%Y') if start_date is not None else ''
                  start_time_str = start_date.strftime('%H:%M') if start_date is not None else ''
                %>
                %if start_date is None:
                  <span class="published-status">This section has not been released.</span>
                  <a href="#" class="schedule-button" data-date="" data-time="" data-id="${section.location}">Schedule</a>
                %else:
                  <span class="published-status"><strong>Will Release:</strong> ${start_date_str} at ${start_time_str}</span>
                  <a href="#" class="edit-button" data-date="${start_date_str}" data-time="${start_time_str}" data-id="${section.location}">Edit</a>
                %endif
              </div>
            </div>
            <div class="item-actions">
              <a href="#" class="delete-button delete-section-button"><span class="delete-icon"></span></a>
              <a href="#" class="drag-handle"></a>
            </div>
          </header>
          <div class="subsection-list">
            <div class="list-header">
              <a href="#" class="new-subsection-item" data-template="${new_subsection_template}">
                <span class="new-folder-icon"></span>New Subsection
              </a>
            </div>
            <ol data-section-id="${section.location.url()}">
              % for subsection in section.get_children():
              <li class="branch collapsed" data-id="${subsection.location}">
                <div class="section-item">
                  <div>
                    <a href="#" class="expand-collapse-icon expand"></a>
                    <a href="${reverse('edit_subsection', args=[subsection.location])}">
                      <span class="folder-icon"></span>
                      <span class="subsection-name"><span class="subsection-name-value">${subsection.display_name}</span></span>
                    </a>
                  </div>
                  <div class="item-actions">
                    <a href="#" class="delete-button delete-subsection-button"><span class="delete-icon"></span></a>                    
                    <a href="#" class="drag-handle"></a>
                  </div>
                </div>
                ${units.enum_units(subsection)}
              </li>
              % endfor
            </ol>
          </div>
        </section>
        % endfor
        
        <section class="courseware-assignment branch" data-id="">
          <header>
            <a href="#" class="expand-collapse-icon collapse"></a>
            <div class="item-details" data-id="">
              <h3 class="assignment-name">
                <span class="assignment-name-span">Mid-Term Exam</span>
              </h3>
              <div class="assignment-name-edit" style="display:none">
                <h3 class="assignment-name">
                  <input type="text" value="Pre-Cursor &amp; Prep" class="edit-section-name" autocomplete="off"> <a href="#" class="save-button edit-assignment-name-save">Save</a><a href="#" class="cancel-button edit-assignment-name-cancel">Cancel</a>
                </h3>
              </div>
              <div class="assignment-published-date">
                <span class="published-status"><strong>Will Release:</strong> 11/20/2012 at 01:00</span> <a href="#" class="edit-button" data-date="11/20/2012" data-time="01:00" data-id="">Edit</a>
              </div>
            </div>
            <div class="item-actions">
              <a href="#" class="delete-button delete-section-button"></a> <a href="#" class="drag-handle"></a>
            </div>
          </header>
          <div class="subsection-list">
            <div class="list-header">
              <a href="#" class="new-subsection-item" data-template="">New Subsection</a>
            </div>
            <ol data-section-id="i4x://Harvard/101/chapter/7fc679d0ec384ceb94da3c990f95173f4">
              <li class="branch collapsed" data-id="i4x://Harvard/101/sequential/eff77c9792034ee4b46e695ade4c0bad">
                <div class="section-item">
                  <div>
                    <a href="#" class="expand-collapse-icon expand"></a> <a href="/subsection/i4x://Harvard/101/sequential/eff77c9792034ee4b46e695ade4c0bad"> <span class="subsection-name"><span class="subsection-name-value">Books &amp; Materials</span></span></a>
                  </div>
                  <div class="item-actions">
                    <a href="#" class="delete-button delete-subsection-button"></a> <a href="#" class="drag-handle"></a>
                  </div>
                </div>
                <ol class="sortable-unit-list" data-subsection-id="i4x://Harvard/101/sequential/eff77c9792034ee4b46e695ade4c0bad2">
                  <li class="leaf unit" data-id="i4x://Harvard/101/vertical/5a30e6b445a741b2a5b9ce0593491f93">
                    <div class="section-item">
                      <a href="/edit/i4x://Harvard/101/vertical/5a30e6b445a741b2a5b9ce0593491f93" class="private-item"><span class="unit-name">Mid Term Section #1</span></a>
                      <div class="item-actions">
                        <a href="#" class="delete-button" data-id="i4x://Harvard/101/vertical/5a30e6b445a741b2a5b9ce0593491f932"></a> <a href="#" class="drag-handle"></a>
                      </div>
                    </div>
                  </li>
                  <li class="leaf unit" data-id="i4x://Harvard/101/vertical/0345f6177481492cacd8cfa822dfd962">
                    <div class="section-item">
                      <a href="/edit/i4x://Harvard/101/vertical/0345f6177481492cacd8cfa822dfd962" class="private-item"><span class="unit-name">Mid Term Section #2</span></a>
                      <div class="item-actions">
                        <a href="#" class="delete-button" data-id="i4x://Harvard/101/vertical/0345f6177481492cacd8cfa822dfd9622"></a> <a href="#" class="drag-handle"></a>
                      </div>
                    </div>
                  </li>
                  <li class="leaf unit" data-id="i4x://Harvard/101/vertical/5dd80571fe4c4c2895d30109e5a3baf5">
                    <div class="section-item">
                      <a href="/edit/i4x://Harvard/101/vertical/5dd80571fe4c4c2895d30109e5a3baf5" class="private-item"><span class="unit-name">Mid Term Section #3</span></a>
                      <div class="item-actions">
                        <a href="#" class="delete-button" data-id="i4x://Harvard/101/vertical/5dd80571fe4c4c2895d30109e5a3baf52"></a> <a href="#" class="drag-handle"></a>
                      </div>
                    </div>
                  </li>
                  <li>
                    <a href="#" class="new-unit-item" data-template="i4x://edx/templates/vertical/Empty" data-parent="i4x://Harvard/101/sequential/eff77c9792034ee4b46e695ade4c0bad">New Unit</a>
                  </li>
                </ol>
              </li>
              <li class="branch collapsed" data-id="i4x://Harvard/101/sequential/e2d34d2e62524045a9da8ccfff23cbd5">
                <div class="section-item">
                  <div>
                    <a href="#" class="expand-collapse-icon expand"></a> <a href="/subsection/i4x://Harvard/101/sequential/e2d34d2e62524045a9da8ccfff23cbd5"> <span class="subsection-name"><span class="subsection-name-value">Software</span></span></a>
                  </div>
                  <div class="item-actions">
                    <a href="#" class="delete-button delete-subsection-button"></a> <a href="#" class="drag-handle"></a>
                  </div>
                </div>
                <ol class="sortable-unit-list" data-subsection-id="i4x://Harvard/101/sequential/e2d34d2e62524045a9da8ccfff23cbd52">
                  <li>
                    <a href="#" class="new-unit-item" data-template="i4x://edx/templates/vertical/Empty" data-parent="i4x://Harvard/101/sequential/e2d34d2e62524045a9da8ccfff23cbd5">New Unit</a>
                  </li>
                </ol>
              </li>
              <li class="branch collapsed" data-id="i4x://Harvard/101/sequential/5add7a2d021f48f58054c1d8bf8a2eea">
                <div class="section-item">
                  <div>
                    <a href="#" class="expand-collapse-icon expand"></a> <a href="/subsection/i4x://Harvard/101/sequential/5add7a2d021f48f58054c1d8bf8a2eea"> <span class="subsection-name"><span class="subsection-name-value">FAQs</span></span></a>
                  </div>
                  <div class="item-actions">
                    <a href="#" class="delete-button delete-subsection-button"></a> <a href="#" class="drag-handle"></a>
                  </div>
                </div>
                <ol class="sortable-unit-list" data-subsection-id="i4x://Harvard/101/sequential/5add7a2d021f48f58054c1d8bf8a2eea2">
                  <li class="leaf unit" data-id="i4x://Harvard/101/vertical/f3cb8c0118424e6b9a058acafc35cc2e">
                    <div class="section-item">
                      <a href="/edit/i4x://Harvard/101/vertical/f3cb8c0118424e6b9a058acafc35cc2e" class="private-item"><span class="unit-name">New Unit</span></a>
                      <div class="item-actions">
                        <a href="#" class="delete-button" data-id="i4x://Harvard/101/vertical/f3cb8c0118424e6b9a058acafc35cc2e2"></a> <a href="#" class="drag-handle"></a>
                      </div>
                    </div>
                  </li>
                  <li class="leaf unit" data-id="i4x://Harvard/101/vertical/d75ed0acf55a48888c7a8f153bc5be43">
                    <div class="section-item">
                      <a href="/edit/i4x://Harvard/101/vertical/d75ed0acf55a48888c7a8f153bc5be43" class="private-item"><span class="unit-name">New Unit</span></a>
                      <div class="item-actions">
                        <a href="#" class="delete-button" data-id="i4x://Harvard/101/vertical/d75ed0acf55a48888c7a8f153bc5be432"></a> <a href="#" class="drag-handle"></a>
                      </div>
                    </div>
                  </li>
                  <li>
                    <a href="#" class="new-unit-item" data-template="i4x://edx/templates/vertical/Empty" data-parent="i4x://Harvard/101/sequential/5add7a2d021f48f58054c1d8bf8a2eea">New Unit</a>
                  </li>
                </ol>
              </li>
            </ol>
          </div>
        </section>
      </article>
    </div>
  </div>
  <footer></footer>
</%block>
